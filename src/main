<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tank Controller TX</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 2rem; background: #101820; color: #eee; }
    h1 { margin-top: 0; }
    button { width: 8rem; height: 3rem; margin: 0.5rem; font-size: 1rem; border: none; border-radius: 0.5rem; cursor: pointer; background: #ff7a18; color: #101820; }
    button.stop { background: #ff3b30; color: #fff; }
    #status { margin-top: 1.5rem; font-size: 1.1rem; }
    .pad { display: grid; grid-template-columns: repeat(3, 8.5rem); grid-template-rows: repeat(3, 3.5rem); gap: 0.5rem; justify-content: center; margin-top: 2rem; }
    .pad button { width: 100%; height: 100%; }
    .speeds { margin-top: 2rem; display: flex; gap: 1.5rem; justify-content: center; }
    .speeds label { display: flex; flex-direction: column; align-items: center; font-size: 0.9rem; }
    input[type=range] { width: 200px; }
    footer { margin-top: 3rem; font-size: 0.85rem; color: #aaa; text-align: center; }
  </style>
</head>
<body>
  <h1>T-Beam Tank Controller</h1>
  <p>Tap a button to send a command over LoRa. Commands are AES-256 encrypted.</p>
  <div class="pad">
    <div></div>
    <button data-cmd="forward">Forward</button>
    <div></div>
    <button data-cmd="left">Left</button>
    <button class="stop" data-cmd="stop">Stop</button>
    <button data-cmd="right">Right</button>
    <div></div>
    <button data-cmd="backward">Backward</button>
    <div></div>
  </div>
  <div class="speeds">
    <label>Left speed
      <input id="leftSpeed" type="range" min="0" max="255" value="255">
      <span id="leftValue">255</span>
    </label>
    <label>Right speed
      <input id="rightSpeed" type="range" min="0" max="255" value="255">
      <span id="rightValue">255</span>
    </label>
    <button data-cmd="speed" id="speedBtn">Set Speeds</button>
  </div>
  <div id="status">State: IDLE</div>
  <footer>Connect to the TankController Wi-Fi network (password: tank12345).</footer>
  <script>
    const statusEl = document.getElementById('status');
    const left = document.getElementById('leftSpeed');
    const right = document.getElementById('rightSpeed');
    const leftValue = document.getElementById('leftValue');
    const rightValue = document.getElementById('rightValue');

    function updateLabels() {
      leftValue.textContent = left.value;
      rightValue.textContent = right.value;
    }
    left.addEventListener('input', updateLabels);
    right.addEventListener('input', updateLabels);
    updateLabels();

    async function sendCommand(cmd) {
      statusEl.textContent = 'State: sending...';
      const params = new URLSearchParams({ action: cmd });
      if (cmd === 'speed') {
        params.set('left', left.value);
        params.set('right', right.value);
      }
      try {
        const res = await fetch('/cmd', { method: 'POST', body: params });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        statusEl.textContent = `State: ${data.state}`;
      } catch (err) {
        statusEl.textContent = 'State: ERROR - ' + err.message;
      }
    }

    document.querySelectorAll('button[data-cmd]').forEach(btn => {
      btn.addEventListener('click', () => sendCommand(btn.dataset.cmd));
    });
    document.getElementById('speedBtn').addEventListener('click', () => sendCommand('speed'));
  </script>
</body>
</html>
